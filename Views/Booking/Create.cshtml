@{
    ViewData["Title"] = "Booking";
    int? menuItemId = ViewBag.MenuItemId as int?;
    var cartItems = ViewBag.CartItems as List<dynamic>;
    var totalPrice = ViewBag.TotalPrice as decimal? ?? 0;
}
<link rel="stylesheet" href="~/css/booking/create.css" asp-append-version="true" />

<div class="booking-wrapper">
    <!-- Header -->
    <div class="booking-header">
        <div class="header-container">
            <a href="@Url.Action("Index", "Cart")" class="back-link">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M12 4L6 10L12 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>Back to Cart</span>
            </a>
            <div class="header-content">
                <h1 class="booking-title">Complete Your Reservation</h1>
                <p class="booking-subtitle">Just a few details to finalize your dining experience</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="booking-container">
        @if (cartItems != null && cartItems.Count == 0)
        {
            <!-- Empty Cart State -->
            <div class="empty-booking">
                <div class="empty-icon">
                    <svg width="120" height="120" viewBox="0 0 120 120" fill="none">
                        <circle cx="60" cy="60" r="55" stroke="currentColor" stroke-width="3" stroke-dasharray="8 8"/>
                        <path d="M40 50C40 50 45 45 60 45C75 45 80 50 80 50M48 70C48 70 52 66 60 66C68 66 72 70 72 70" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                        <circle cx="48" cy="55" r="4" fill="currentColor"/>
                        <circle cx="72" cy="55" r="4" fill="currentColor"/>
                    </svg>
                </div>
                <h2 class="empty-title">Your cart is empty</h2>
                <p class="empty-description">Add items to your cart before proceeding with a reservation</p>
                <a href="@Url.Action("Index", "Menu")" class="btn-empty">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M3 4H17M3 8H17M3 12H17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>Browse Menu</span>
                </a>
            </div>
        }
        else
        {
            <div class="booking-layout">
                <!-- Booking Form -->
                <div class="booking-form-section">
                    <div class="form-card">
                        <div class="form-header">
                            <div class="form-icon">
                                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                                    <rect x="6" y="8" width="20" height="20" rx="3" stroke="currentColor" stroke-width="2"/>
                                    <path d="M10 4V10M22 4V10M6 14H26" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </div>
                            <div>
                                <h2 class="form-title">Reservation Details</h2>
                                <p class="form-description">Please provide your information</p>
                            </div>
                        </div>

                        @if (!string.IsNullOrEmpty(ViewBag.Error))
                        {
                            <div class="error-alert">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="2"/>
                                    <path d="M10 6V11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    <circle cx="10" cy="14" r="1" fill="currentColor"/>
                                </svg>
                                <span>@ViewBag.Error</span>
                            </div>
                        }

                        <form method="post" class="booking-form">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="menuItemId" value="@menuItemId" />

                            <div class="form-group">
                                <label class="form-label" for="customerName">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <path d="M8 8C10.21 8 12 6.21 12 4C12 1.79 10.21 0 8 0C5.79 0 4 1.79 4 4C4 6.21 5.79 8 8 8ZM8 10C5.33 10 0 11.34 0 14V16H16V14C16 11.34 10.67 10 8 10Z" fill="currentColor"/>
                                    </svg>
                                    Customer Name
                                </label>
                                <input 
                                    id="customerName"
                                    name="customerName" 
                                    type="text"
                                    class="form-input" 
                                    placeholder="Enter your full name" 
                                    required />
                                <span class="form-hint">This name will be used for your reservation</span>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="tableId">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <rect x="2" y="6" width="12" height="8" rx="1" stroke="currentColor" stroke-width="2"/>
                                        <path d="M4 6V4M12 6V4M6 10H10M6 12H10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    Table
                                </label>
                                @{
                                    var tables = ViewBag.Tables as List<Resturant_Menu.Models.Table> ?? new List<Resturant_Menu.Models.Table>();
                                }
                                <input id="tableSearch" type="text" class="form-input" placeholder="Search tables by number" />
                                <select id="tableId" name="tableId" class="form-input" required style="margin-top:8px;">
                                    @foreach (var t in tables)
                                    {
                                        if (t.IsAvailable)
                                        {
                                            <option value="@t.Id">@t.Number</option>
                                        }
                                        else
                                        {
                                            <option value="@t.Id" disabled>@t.Number (unavailable)</option>
                                        }
                                    }
                                </select>
                                <span class="form-hint">Search and select an available table (1-21)</span>
                                <script>
                                    (function(){
                                        var search = document.getElementById('tableSearch');
                                        var sel = document.getElementById('tableId');
                                        if(!search || !sel) return;
                                        search.addEventListener('input', function(e){
                                            var q = e.target.value.trim();
                                            for(var i=0;i<sel.options.length;i++){
                                                var opt = sel.options[i];
                                                opt.style.display = (q === '' || opt.text.indexOf(q) !== -1) ? '' : 'none';
                                            }
                                        });
                                    })();
                                </script>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn-submit">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M16 4L7 13L3 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <span>Confirm Reservation</span>
                                </button>
                                <a href="@Url.Action("Index", "Cart")" class="btn-cancel">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M12 4L6 10L12 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    <span>Edit Cart</span>
                                </a>
                            </div>
                        </form>

                        <!-- Info Box -->
                        <div class="info-box">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="2"/>
                                <path d="M10 6V10M10 13H10.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <div>
                                <strong>Quick Booking Process</strong>
                                <p>We only need your name and table number to complete your reservation</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="summary-section">
                    <div class="summary-card">
                        <div class="summary-header">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                                <path d="M9 3V7M15 3V7M3 10H21M7 14H11M7 17H13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <h2 class="summary-title">Order Summary</h2>
                        </div>

                        @if (cartItems != null && cartItems.Count > 0)
                        {
                            <div class="summary-items">
                                @foreach (var item in cartItems)
                                {
                                    <div class="summary-item">
                                        <div class="item-info">
                                            <span class="item-name">@item.Name</span>
                                            <span class="item-quantity">×@item.Quantity</span>
                                        </div>
                                        <span class="item-price">$@item.Subtotal.ToString("F2")</span>
                                    </div>
                                }
                            </div>

                            <div class="summary-divider"></div>

                            <div class="summary-total">
                                <span class="total-label">Total Amount</span>
                                <span class="total-value">$@totalPrice.ToString("F2")</span>
                            </div>

                            <div class="summary-note">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M8 2L9.5 6.5H14L10.5 9.5L12 14L8 11L4 14L5.5 9.5L2 6.5H6.5L8 2Z" fill="currentColor"/>
                                </svg>
                                <span>All items prepared fresh to order</span>
                            </div>
                        }
                    </div>

                    <!-- Features -->
                    <div class="features-list">
                        <div class="feature-item">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M16 4L7 13L3 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Simple booking process</span>
                        </div>
                        <div class="feature-item">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2"/>
                                <path d="M10 6V10L13 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <span>Fresh ingredients daily</span>
                        </div>
                        <div class="feature-item">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M10 2L12.5 7.5L19 8.5L14.5 12.5L16 19L10 16L4 19L5.5 12.5L1 8.5L7.5 7.5L10 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                            </svg>
                            <span>Premium dining experience</span>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>
